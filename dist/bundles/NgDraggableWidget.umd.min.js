!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],i):i((t.ng=t.ng||{},t.ng.draggable=t.ng.draggable||{},t.ng.draggable.widget={}),t.ng.core)}(this,function(t,r){"use strict";var h=function(){function t(t,i){this._ngEl=t,this._renderer=i}return t.prototype.registerGrid=function(t){this._ngWidgetContainer=t},t.prototype.ngOnInit=function(){this._renderer.setElementClass(this._ngEl.nativeElement,"widget-placeholder",!0),this._ngWidgetContainer.autoStyle&&this._renderer.setElementStyle(this._ngEl.nativeElement,"position","absolute")},t.prototype.setSize=function(t){this._size=t,this._recalculateDimensions()},t.prototype.setGridPosition=function(t){this._position=t,this._recalculatePosition()},t.prototype.setCascadeMode=function(t){switch(this._cascadeMode=t){case"up":case"left":default:this._renderer.setElementStyle(this._ngEl.nativeElement,"left","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"right",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",null);break;case"right":this._renderer.setElementStyle(this._ngEl.nativeElement,"right","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"left",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",null);break;case"down":this._renderer.setElementStyle(this._ngEl.nativeElement,"left","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom","0px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"right",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",null)}},t.prototype._setDimensions=function(t,i){this._renderer.setElementStyle(this._ngEl.nativeElement,"width",t+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"height",i+"px")},t.prototype._setPosition=function(t,i){switch(this._cascadeMode){case"up":case"left":default:this._renderer.setElementStyle(this._ngEl.nativeElement,"transform","translate("+t+"px, "+i+"px)");break;case"right":this._renderer.setElementStyle(this._ngEl.nativeElement,"transform","translate("+-t+"px, "+i+"px)");break;case"down":this._renderer.setElementStyle(this._ngEl.nativeElement,"transform","translate("+t+"px, "+-i+"px)")}},t.prototype._recalculatePosition=function(){var t=(this._ngWidgetContainer.colWidth+this._ngWidgetContainer.marginLeft+this._ngWidgetContainer.marginRight)*(this._position.col-1)+this._ngWidgetContainer.marginLeft,i=(this._ngWidgetContainer.rowHeight+this._ngWidgetContainer.marginTop+this._ngWidgetContainer.marginBottom)*(this._position.row-1)+this._ngWidgetContainer.marginTop;this._setPosition(t,i)},t.prototype._recalculateDimensions=function(){var t=this._ngWidgetContainer.colWidth*this._size.x+(this._ngWidgetContainer.marginLeft+this._ngWidgetContainer.marginRight)*(this._size.x-1),i=this._ngWidgetContainer.rowHeight*this._size.y+(this._ngWidgetContainer.marginTop+this._ngWidgetContainer.marginBottom)*(this._size.y-1);this._setDimensions(t,i)},t.decorators=[{type:r.Component,args:[{selector:"ng-widget-placeholder",template:""}]}],t.ctorParameters=function(){return[{type:r.ElementRef},{type:r.Renderer}]},t}(),i=function(){function o(t,i,e,n,s){this._differs=t,this._ngEl=i,this._renderer=e,this.componentFactoryResolver=n,this._containerRef=s,this.onDragStart=new r.EventEmitter,this.onDrag=new r.EventEmitter,this.onDragStop=new r.EventEmitter,this.onResizeStart=new r.EventEmitter,this.onResize=new r.EventEmitter,this.onResizeStop=new r.EventEmitter,this.onItemChange=new r.EventEmitter,this.colWidth=250,this.rowHeight=250,this.minCols=1,this.minRows=1,this.marginTop=10,this.marginRight=10,this.marginBottom=10,this.marginLeft=10,this.isDragging=!1,this.isResizing=!1,this.autoStyle=!0,this.resizeEnable=!0,this.dragEnable=!0,this.cascade="up",this.minWidth=100,this.minHeight=100,this.zIndex=1,this.allowOverlap=!1,this.widget_width_factor=0,this.widget_height_factor=0,this._items=[],this._draggingItem=null,this._resizingItem=null,this._resizeDirection=null,this._itemGrid={},this._maxCols=0,this._maxRows=0,this._visibleCols=0,this._visibleRows=0,this._setWidth=250,this._setHeight=250,this._posOffset=null,this._adding=!1,this._placeholderRef=null,this._fixToGrid=!1,this._autoResize=!1,this._destroyed=!1,this._maintainRatio=!1,this._preferNew=!1,this._zoomOnDrag=!1,this._limitToScreen=!1,this._curMaxRow=0,this._curMaxCol=0,this._dragReady=!1,this._resizeReady=!1,this._config=o.CONST_DEFAULT_CONFIG}return Object.defineProperty(o.prototype,"config",{set:function(t){this.setConfig(t),null==this._differ&&null!=t&&(this._differ=this._differs.find(this._config).create(null))},enumerable:!0,configurable:!0}),o.prototype.ngOnInit=function(){this._renderer.setElementClass(this._ngEl.nativeElement,"widget-container",!0),this.autoStyle&&this._renderer.setElementStyle(this._ngEl.nativeElement,"position","relative"),this.setConfig(this._config)},o.prototype.ngOnDestroy=function(){this._destroyed=!0},o.prototype.getConfig=function(){return this._config},o.prototype.setConfig=function(t){this._config=t;var i=!1;for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],s=n?parseInt(n,10):0;switch(e){case"margins":this.setMargins(n);break;case"col_width":this.colWidth=Math.max(s,1);break;case"row_height":this.rowHeight=Math.max(s,1);break;case"auto_style":this.autoStyle=!!n;break;case"auto_resize":this._autoResize=!!n;break;case"draggable":this.dragEnable=!!n;break;case"resizable":this.resizeEnable=!!n;break;case"max_rows":i=i||this._maxRows!==s,this._maxRows=s<0?0:s;break;case"max_cols":i=i||this._maxCols!==s,this._maxCols=s<0?0:s;break;case"visible_rows":this._visibleRows=Math.max(s,0);break;case"visible_cols":this._visibleCols=Math.max(s,0);break;case"min_rows":this.minRows=Math.max(s,1);break;case"min_cols":this.minCols=Math.max(s,1);break;case"min_height":this.minHeight=Math.max(s,1);break;case"min_width":this.minWidth=Math.max(s,1);break;case"zoom_on_drag":this._zoomOnDrag=!!n;break;case"cascade":this.cascade!==n&&(this.cascade=n,this._cascadeGrid());break;case"fix_to_grid":this._fixToGrid=!!n;break;case"maintain_ratio":this._maintainRatio=!!n;break;case"prefer_new":this._preferNew=!!n;break;case"limit_to_screen":this._limitToScreen=!this._autoResize&&!!n,this._limitToScreen&&(this._maxCols=this._getContainerColumns());break;case"allow_overlap":this.allowOverlap=!!n;break;case"widget_width_factor":this.widget_width_factor=Math.max(s,0);break;case"widget_height_factor":this.widget_height_factor=Math.max(s,0)}}if(this._maintainRatio&&(this.colWidth&&this.rowHeight?this._aspectRatio=this.colWidth/this.rowHeight:this._maintainRatio=!1),i){if(0<this._maxCols&&0<this._maxRows)switch(this.cascade){case"left":case"right":this._maxCols=0;break;case"up":case"down":default:this._maxRows=0}this.updatePositionsAfterMaxChange()}this._calculateColWidth(),this._calculateRowHeight();var o=this._maxCols*this.colWidth,r=this._maxRows*this.rowHeight;0<o&&this.minWidth>o&&(this.minWidth=.75*this.colWidth),0<r&&this.minHeight>r&&(this.minHeight=.75*this.rowHeight),this.minWidth>this.colWidth&&(this.minCols=Math.max(this.minCols,Math.ceil(this.minWidth/this.colWidth))),this.minHeight>this.rowHeight&&(this.minRows=Math.max(this.minRows,Math.ceil(this.minHeight/this.rowHeight))),0<this._maxCols&&this.minCols>this._maxCols&&(this.minCols=1),0<this._maxRows&&this.minRows>this._maxRows&&(this.minRows=1),this._updateRatio();for(var h=0,a=this._items;h<a.length;h++){var l=a[h];this._removeFromGrid(l),l.setCascadeMode(this.cascade)}for(var g=0,_=this._items;g<_.length;g++){(l=_[g]).recalculateSelf(),this._addToGrid(l)}this._cascadeGrid(),this._filterGrid(),this._updateSize()},o.prototype.getItemPosition=function(t){return this._items[t].getWidgetPosition()},o.prototype.getItemSize=function(t){return this._items[t].getSize()},o.prototype.ngDoCheck=function(){if(null!=this._differ){var t=this._differ.diff(this._config);if(null!=t)return this._config.debug&&console.log("ngDoCheck -> NgWidgetContainer"),this._applyChanges(t),!0}return!1},o.prototype.setMargins=function(t){this.marginTop=Math.max(parseInt(t[0],10),0),this.marginRight=2<=t.length?Math.max(parseInt(t[1],10),0):this.marginTop,this.marginBottom=3<=t.length?Math.max(parseInt(t[2],10),0):this.marginTop,this.marginBottom=3<=t.length?Math.max(parseInt(t[2],10),0):this.marginTop,this.marginLeft=4<=t.length?Math.max(parseInt(t[3],10),0):this.marginRight},o.prototype.enableDrag=function(){this.dragEnable=!0},o.prototype.disableDrag=function(){this.dragEnable=!1},o.prototype.enableResize=function(){this.resizeEnable=!0},o.prototype.disableResize=function(){this.resizeEnable=!1},o.prototype.addItem=function(t){if(t.setCascadeMode(this.cascade),!this._preferNew){var i=this._fixGridPosition(t.getWidgetPosition(),t.getSize());t.setGridPosition(i)}this._items.push(t),this._addToGrid(t),this._updateSize(),t.recalculateSelf(),t.onCascadeEvent(),this._emitOnItemChange()},o.prototype.removeItem=function(t){this._removeFromGrid(t);for(var i=0;i<this._items.length;i++)this._items[i]===t&&this._items.splice(i,1);this._destroyed||this.allowOverlap||(this._cascadeGrid(),this._updateSize(),this._items.forEach(function(t){return t.recalculateSelf()}),this._emitOnItemChange())},o.prototype.updateItem=function(t){this._removeFromGrid(t),this._addToGrid(t),this._cascadeGrid(),this._updateSize(),t.onCascadeEvent()},o.prototype.triggerCascade=function(){this._cascadeGrid(null,null)},o.prototype.triggerResize=function(){this.resizeEventHandler(null)},o.prototype.resizeEventHandler=function(t){this._calculateColWidth(),this._calculateRowHeight(),this._updateRatio(),this._limitToScreen&&this._maxCols!==this._getContainerColumns()&&(this._maxCols=this._getContainerColumns(),this.updatePositionsAfterMaxChange(),this._cascadeGrid()),this._filterGrid(),this._updateSize()},o.prototype.mouseDownEventHandler=function(t){var i=this._getMousePosition(t),e=this._getItemFromPosition(i);null!=e&&(this.resizeEnable&&e.canResize(t)?(this._resizeReady=!0,t.preventDefault()):this.dragEnable&&e.canDrag(t)&&(this._dragReady=!0,t.preventDefault()))},o.prototype.mouseUpEventHandler=function(t){this.isDragging?this._dragStop(t):this.isResizing?this._resizeStop(t):(this._dragReady||this._resizeReady)&&(this._dragReady=!1,this._resizeReady=!1)},o.prototype.mouseMoveEventHandler=function(t){if(this._resizeReady)return this._resizeStart(t),void t.preventDefault();if(this._dragReady)return this._dragStart(t),void t.preventDefault();if(this.isDragging)this._drag(t);else if(this.isResizing)this._resize(t);else{var i=this._getMousePosition(t),e=this._getItemFromPosition(i);e&&e.onMouseMove(t)}},o.prototype.updatePositionsAfterMaxChange=function(){for(var t=0,i=this._items;t<i.length;t++){var e=i[t],n=e.getWidgetPosition(),s=e.getSize();if(!(!this._hasGridCollision(n,s)&&this._isWithinBounds(n,s)&&s.x<=this._maxCols&&s.y<=this._maxRows)){if(this._removeFromGrid(e),0<this._maxCols&&s.x>this._maxCols?(s.x=this._maxCols,e.setSize(s)):0<this._maxRows&&s.y>this._maxRows&&(s.y=this._maxRows,e.setSize(s)),this._hasGridCollision(n,s)||!this._isWithinBounds(n,s)){var o=this._fixGridPosition(n,s);e.setGridPosition(o)}this._addToGrid(e)}}},o.prototype._calculateColWidth=function(){if(this._autoResize&&(0<this._maxCols||0<this._visibleCols)){var t=0<this._maxCols?this._maxCols:this._visibleCols,i=this._ngEl.nativeElement.getBoundingClientRect().width,e=Math.floor(i/t);0<(e-=this.marginLeft+this.marginRight)&&(this.colWidth=e)}(this.colWidth<this.minWidth||this.minCols>this._config.min_cols)&&(this.minCols=Math.max(this._config.min_cols,Math.ceil(this.minWidth/this.colWidth)))},o.prototype._calculateRowHeight=function(){if(this._autoResize&&(0<this._maxRows||0<this._visibleRows)){var t=0<this._maxRows?this._maxRows:this._visibleRows,i=window.innerHeight-this.marginTop-this.marginBottom,e=Math.max(Math.floor(i/t),this.minHeight);0<(e-=this.marginTop+this.marginBottom)&&(this.rowHeight=e)}(this.rowHeight<this.minHeight||this.minRows>this._config.min_rows)&&(this.minRows=Math.max(this._config.min_rows,Math.ceil(this.minHeight/this.rowHeight)))},o.prototype._updateRatio=function(){this._autoResize&&this._maintainRatio&&(0<this._maxCols&&this._visibleRows<=0?this.rowHeight=this.colWidth/this._aspectRatio:0<this._maxRows&&this._visibleCols<=0?this.colWidth=this._aspectRatio*this.rowHeight:0===this._maxCols&&0===this._maxRows&&(0<this._visibleCols?this.rowHeight=this.colWidth/this._aspectRatio:0<this._visibleRows&&(this.colWidth=this._aspectRatio*this.rowHeight)))},o.prototype._applyChanges=function(t){var i=this;t.forEachAddedItem(function(t){i._config[t.key]=t.currentValue}),t.forEachChangedItem(function(t){i._config[t.key]=t.currentValue}),t.forEachRemovedItem(function(t){delete i._config[t.key]}),this.setConfig(this._config)},o.prototype._resizeStart=function(t){if(this.resizeEnable){var i=this._getMousePosition(t),e=this._getItemFromPosition(i);e&&(e.startMoving(),this._resizingItem=e,this._resizeDirection=e.canResize(t),this._removeFromGrid(e),this._createPlaceholder(e),this.isResizing=!0,this._resizeReady=!1,this.onResizeStart.emit(e),e.onResizeStartEvent())}},o.prototype._dragStart=function(t){if(this.dragEnable){var i=this._getMousePosition(t),e=this._getItemFromPosition(i);if(e){var n=e.getPosition(),s={left:i.left-n.left,top:i.top-n.top};e.setWidgetDragStartPosition(e.getWidgetPosition()),this._config.debug&&console.log("_dragStart -> dragStartPosition",e.getWidgetDragStartPosition()),e.startMoving(),this._draggingItem=e,this._posOffset=s,this._removeFromGrid(e),this._createPlaceholder(e),this.isDragging=!0,this._dragReady=!1,this.onDragStart.emit(e),e.onDragStartEvent(),this._zoomOnDrag&&this._zoomOut()}}},o.prototype._zoomOut=function(){this._renderer.setElementStyle(this._ngEl.nativeElement,"transform","scale(0.5, 0.5)")},o.prototype._resetZoom=function(){this._renderer.setElementStyle(this._ngEl.nativeElement,"transform","")},o.prototype._drag=function(t){if(this.isDragging){this._config.debug&&console.log("_drag"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var i=this._getMousePosition(t),e=i.left-this._posOffset.left,n=i.top-this._posOffset.top,s=this._draggingItem.getWidgetPosition(),o=this._calculateGridPosition(e,n),r=this._draggingItem.getSize();o=this._fixPosToBoundsX(o,r),this._isWithinBoundsY(o,r)||(o=this._fixPosToBoundsY(o,r)),o.col===s.col&&o.row===s.row||(this._config.debug&&console.log("_drag",o,s),this._draggingItem.setGridPosition(o,this._fixToGrid),this._placeholderRef.instance.setGridPosition(o),0<=["up","down","left","right"].indexOf(this.cascade)&&((10<Math.abs(o.col-s.col)||10<Math.abs(o.row-s.row))&&(this._config.debug&&console.log("_drag fixGridCollision",o,r),this._fixGridCollisions(o,r)),this._config.debug&&console.log("_drag cascade",o,r),this._cascadeGrid(o,r))),this._fixToGrid||this._draggingItem.setPosition(e,n),this.onDrag.emit(this._draggingItem),this._draggingItem.onDragEvent()}},o.prototype._resize=function(t){if(this.isResizing){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var i=this._getMousePosition(t),e=this._resizingItem.getPosition(),n=this._resizingItem.getDimensions(),s="height"===this._resizeDirection?n.width:i.left-e.left+10,o="width"===this._resizeDirection?n.height:i.top-e.top+10;s<this.minWidth&&(s=this.minWidth),o<this.minHeight&&(o=this.minHeight),s<this._resizingItem.minWidth&&(s=this._resizingItem.minWidth),o<this._resizingItem.minHeight&&(o=this._resizingItem.minHeight);var r=this._calculateGridSize(s,o),h=this._resizingItem.getSize(),a=this._resizingItem.getWidgetPosition();this._isWithinBoundsX(a,r)||(r=this._fixSizeToBoundsX(a,r)),this._isWithinBoundsY(a,r)||(r=this._fixSizeToBoundsY(a,r)),(r=this._resizingItem.fixResize(r)).x===h.x&&r.y===h.y||(this._resizingItem.setSize(r,this._fixToGrid),this._placeholderRef.instance.setSize(r),0<=["up","down","left","right"].indexOf(this.cascade)&&(this._fixGridCollisions(a,r),this._cascadeGrid(a,r))),this._fixToGrid||this._resizingItem.setDimensions(s,o);var l=this._maxGridSize(e.left+s+2*t.movementX,e.top+o+2*t.movementY);"height"===this._resizeDirection&&(l.x=a.col+h.x),"width"===this._resizeDirection&&(l.y=a.row+h.y),this.onResize.emit(this._resizingItem),this._resizingItem.onResizeEvent()}},o.prototype._dragStop=function(t){if(this.isDragging){this.isDragging=!1;var i=this._draggingItem.getWidgetPosition(),e=this._draggingItem.getWidgetDragStartPosition();this._config.debug&&console.log("_dragStop itemPos, dragStartPos",i,e),this._draggingItem.setGridPosition(i),this._addToGrid(this._draggingItem),this._cascadeGrid(),this._updateSize(),this._filterGrid(),this._draggingItem.stopMoving(),this._draggingItem.onDragStopEvent(),this.onDragStop.emit(this._draggingItem),this._draggingItem=null,this._posOffset=null,this._placeholderRef.destroy(),this._emitOnItemChange(),this._zoomOnDrag&&this._resetZoom()}},o.prototype._resizeStop=function(t){if(this.isResizing){this.isResizing=!1;var i=this._resizingItem.getSize();this._resizingItem.setSize(i),this._addToGrid(this._resizingItem),this._cascadeGrid(),this._updateSize(),this._filterGrid(),this._resizingItem.stopMoving(),this._resizingItem.onResizeStopEvent(),this.onResizeStop.emit(this._resizingItem),this._resizingItem=null,this._resizeDirection=null,this._placeholderRef.destroy(),this._emitOnItemChange()}},o.prototype._maxGridSize=function(t,i){return{x:Math.ceil(t/(this.colWidth+this.marginLeft+this.marginRight)),y:Math.ceil(i/(this.rowHeight+this.marginTop+this.marginBottom))}},o.prototype._calculateGridSize=function(t,i){t+=this.marginLeft+this.marginRight,i+=this.marginTop+this.marginBottom;var e=Math.max(this.minCols,Math.round(t/(this.colWidth+this.marginLeft+this.marginRight))),n=Math.max(this.minRows,Math.round(i/(this.rowHeight+this.marginTop+this.marginBottom)));return this._isWithinBoundsX({col:1,row:1},{x:e,y:n})||(e=this._maxCols),this._isWithinBoundsY({col:1,row:1},{x:e,y:n})||(n=this._maxRows),{x:e,y:n}},o.prototype._calculateGridPosition=function(t,i){var e=Math.max(1,Math.round(t/(this.colWidth+this.marginLeft+this.marginRight))+1),n=Math.max(1,Math.round(i/(this.rowHeight+this.marginTop+this.marginBottom))+1);return this._isWithinBoundsX({col:e,row:n},{x:1,y:1})||(e=this._maxCols),this._isWithinBoundsY({col:e,row:n},{x:1,y:1})||(n=this._maxRows),{col:e,row:n}},o.prototype._hasGridCollision=function(t,i){var e=this._getCollisions(t,i);return null!=e&&0!==e.length&&e.some(function(t){return!(null===t)})},o.prototype._getCollisions=function(t,i){var e=[];t.col||(t.col=1),t.row||(t.row=1);for(var n=0;n<i.y;n++)if(null!=this._itemGrid[t.row+n])for(var s=0;s<i.x;s++)if(null!=this._itemGrid[t.row+n][t.col+s]){var o=this._itemGrid[t.row+n][t.col+s];e.indexOf(o)<0&&e.push(o);var r=o.getWidgetPosition(),h=o.getSize();s=r.col+h.x-t.col}return e},o.prototype._fixGridCollisions=function(t,i){if(!this.allowOverlap)for(;this._hasGridCollision(t,i);){var e=this._getCollisions(t,i);this._removeFromGrid(e[0]);var n=e[0].getWidgetPosition(),s=e[0].getSize();switch(this.cascade){case"up":case"down":default:var o=n.row;n.row=t.row+i.y,this._isWithinBoundsY(n,s)||(n.col=t.col+i.x,n.row=o);break;case"left":case"right":var r=n.col;n.col=t.col+i.x,this._isWithinBoundsX(n,s)||(n.col=r,n.row=t.row+i.y)}e[0].setGridPosition(n),this._fixGridCollisions(n,s),this._addToGrid(e[0]),e[0].onCascadeEvent()}},o.prototype._cascadeGrid=function(t,i){if(!this._destroyed&&!this.allowOverlap){if(t&&!i)throw new Error("Cannot cascade with only position and not dimensions");switch(this.isDragging&&this._draggingItem&&!t&&!i?(t=this._draggingItem.getWidgetPosition(),i=this._draggingItem.getSize()):this.isResizing&&this._resizingItem&&!t&&!i&&(t=this._resizingItem.getWidgetPosition(),i=this._resizingItem.getSize()),this.cascade){case"up":case"down":for(var e=[0],n=1;n<=this._curMaxCol;n++)e[n]=1;for(var s=1;s<=this._curMaxRow;s++)if(void 0!==this._itemGrid[s])for(var o=1;o<=this._curMaxCol&&void 0!==this._itemGrid[s];o++)if(!(s<e[o])&&null!=this._itemGrid[s][o]){if((_=this._itemGrid[s][o]).isFixed)continue;var r=_.getWidgetPosition(),h=_.getSize();if(r.col!==o||r.row!==s)continue;var a=e[o];for(n=1;n<h.x;n++)a=Math.max(e[o+n],a);t&&o+h.x>t.col&&o<t.col+i.x&&(s>=t.row&&s<t.row+i.y||h.y>t.row-a&&s>=t.row+i.y&&a<t.row+i.y)&&(a=Math.round(Math.max(a,t.row+i.y)));var l={col:o,row:a};a!==r.row&&this._isWithinBoundsY(l,h)&&(this._removeFromGrid(_),_.setGridPosition(l),_.onCascadeEvent(),this._addToGrid(_));for(n=0;n<h.x;n++)e[o+n]=a+h.y}break;case"left":case"right":var g=[0];for(n=1;n<=this._curMaxRow;n++)g[n]=1;for(s=1;s<=this._curMaxRow;s++)if(void 0!==this._itemGrid[s])for(o=1;o<=this._curMaxCol&&void 0!==this._itemGrid[s];o++)if(!(o<g[s])&&null!=this._itemGrid[s][o]){var _;h=(_=this._itemGrid[s][o]).getSize();if((r=_.getWidgetPosition()).col!==o||r.row!==s)continue;for(a=g[s],n=1;n<h.y;n++)a=Math.max(g[s+n],a);t&&s+h.y>t.row&&s<t.row+i.y&&(o>=t.col&&o<t.col+i.x||h.x>t.col-a&&o>=t.col+i.x&&a<t.col+i.x)&&(a=Math.max(a,t.col+i.x));l={col:Math.round(a),row:s};a!==r.col&&a<r.col&&this._isWithinBoundsX(l,h)&&(this._removeFromGrid(_),this._config.debug&&console.log("_cascadeGrid called setGridPosition",this.cascade,a,r,l,h),_.setGridPosition(l),_.onCascadeEvent(),this._addToGrid(_));for(n=0;n<h.y;n++)g[s+n]=a+h.x}}}},o.prototype._cascadePlaceHolder=function(t,i){if(!this._destroyed&&!this.allowOverlap){if(t&&!i)throw new Error("Cannot cascade with only position and not dimensions");switch(this.isDragging&&this._draggingItem&&!t&&!i?(t=this._draggingItem.getWidgetPosition(),i=this._draggingItem.getSize()):this.isResizing&&this._resizingItem&&!t&&!i&&(t=this._resizingItem.getWidgetPosition(),i=this._resizingItem.getSize()),this.cascade){case"up":case"down":for(var e=[0],n=1;n<=this._curMaxCol;n++)e[n]=1;for(var s=1;s<=this._curMaxRow;s++)if(void 0!==this._itemGrid[s])for(var o=1;o<=this._curMaxCol&&void 0!==this._itemGrid[s];o++)if(!(s<e[o])&&null!=this._itemGrid[s][o]){if((_=this._itemGrid[s][o]).isFixed)continue;var r=_.getWidgetPosition(),h=_.getSize();if(r.col!==o||r.row!==s)continue;var a=e[o];for(n=1;n<h.x;n++)a=Math.max(e[o+n],a);t&&o+h.x>t.col&&o<t.col+i.x&&(s>=t.row&&s<t.row+i.y||h.y>t.row-a&&s>=t.row+i.y&&a<t.row+i.y)&&(a=Math.max(a,t.row+i.y));var l={col:o,row:a};a!==r.row&&this._isWithinBoundsY(l,h)&&this._placeholderRef.instance.setGridPosition(l);for(n=0;n<h.x;n++)e[o+n]=a+h.y}break;case"left":case"right":var g=[0];for(n=1;n<=this._curMaxRow;n++)g[n]=1;for(s=1;s<=this._curMaxRow;s++)if(void 0!==this._itemGrid[s])for(o=1;o<=this._curMaxCol&&void 0!==this._itemGrid[s];o++)if(!(o<g[s])&&null!=this._itemGrid[s][o]){var _;h=(_=this._itemGrid[s][o]).getSize();if((r=_.getWidgetPosition()).col!==o||r.row!==s)continue;for(a=g[s],n=1;n<h.y;n++)a=Math.max(g[s+n],a);t&&s+h.y>t.row&&s<t.row+i.y&&(o>=t.col&&o<t.col+i.x||h.x>t.col-a&&o>=t.col+i.x&&a<t.col+i.x)&&(a=Math.max(a,t.col+i.x));l={col:a,row:s};a!==r.col&&a<r.col&&this._isWithinBoundsX(l,h)&&this._placeholderRef.instance.setGridPosition(l);for(n=0;n<h.y;n++)g[s+n]=a+h.x}}}},o.prototype._fixGridPosition=function(t,i){for(;this._hasGridCollision(t,i)||!this._isWithinBounds(t,i);){if(this._hasGridCollision(t,i)){var e=this._getCollisions(t,i);switch(this.cascade){case"up":case"down":default:t.row=Math.max.apply(null,e.map(function(t){return t.row+t.sizey}));break;case"left":case"right":t.col=Math.max.apply(null,e.map(function(t){return t.col+t.sizex}))}}this._isWithinBoundsY(t,i)||(t.col++,t.row=1),this._isWithinBoundsX(t,i)||(t.row++,t.col=1)}return t},o.prototype._isWithinBoundsX=function(t,i){return 0===this._maxCols||1===t.col||t.col+i.x-1<=this._maxCols},o.prototype._fixPosToBoundsX=function(t,i){return this._isWithinBoundsX(t,i)||(t.col=Math.max(this._maxCols-(i.x-1),1),t.row++),t},o.prototype._fixSizeToBoundsX=function(t,i){return this._isWithinBoundsX(t,i)||(i.x=Math.max(this._maxCols-(t.col-1),1),i.y++),i},o.prototype._isWithinBoundsY=function(t,i){return 0===this._maxRows||1===t.row||t.row+i.y-1<=this._maxRows},o.prototype._fixPosToBoundsY=function(t,i){return this._isWithinBoundsY(t,i)||(t.row=Math.max(this._maxRows-(i.y-1),1),t.col++),t},o.prototype._fixSizeToBoundsY=function(t,i){return this._isWithinBoundsY(t,i)||(i.y=Math.max(this._maxRows-(t.row-1),1),i.x++),i},o.prototype._isWithinBounds=function(t,i){return this._isWithinBoundsX(t,i)&&this._isWithinBoundsY(t,i)},o.prototype._fixPosToBounds=function(t,i){return this._fixPosToBoundsX(this._fixPosToBoundsY(t,i),i)},o.prototype._fixSizeToBounds=function(t,i){return this._fixSizeToBoundsX(t,this._fixSizeToBoundsY(t,i))},o.prototype._addToGrid=function(t){var i=t.getWidgetPosition(),e=t.getSize();this._hasGridCollision(i,e)&&(this._fixGridCollisions(i,e),i=t.getWidgetPosition());for(var n=0;n<e.y;n++){null==this._itemGrid[i.row+n]&&(this._itemGrid[i.row+n]={});for(var s=0;s<e.x;s++)this._itemGrid[i.row+n][i.col+s]=t}},o.prototype._removeFromGrid=function(t){for(var i in this._itemGrid)for(var e in this._itemGrid[i])this._itemGrid[i][e]===t&&delete this._itemGrid[i][e]},o.prototype._filterGrid=function(){for(var t in this._itemGrid){for(var i in this._itemGrid[t]){var e=this._itemGrid[t][i],n=t<e.row+e.sizey&&t>=e.row,s=i<e.col+e.sizex&&i>=e.col;(this._items.indexOf(this._itemGrid[t][i])<0||!n||!s)&&delete this._itemGrid[t][i]}0===Object.keys(this._itemGrid[t]).length&&delete this._itemGrid[t]}},o.prototype._updateSize=function(){if(!this._destroyed){var t=this._getMaxCol(),i=this._getMaxRow();t===this._curMaxCol&&i===this._curMaxRow||(this._curMaxCol=t,this._curMaxRow=i),this._renderer.setElementStyle(this._ngEl.nativeElement,"width","100%"),this._renderer.setElementStyle(this._ngEl.nativeElement,"height",i*(this.rowHeight+this.marginTop+this.marginBottom)+"px")}},o.prototype._getMaxRow=function(){return Math.max.apply(null,this._items.map(function(t){return t.row+t.sizey-1}))},o.prototype._getMaxCol=function(){return Math.max.apply(null,this._items.map(function(t){return t.col+t.sizex-1}))},o.prototype._getMousePosition=function(t){(window.TouchEvent&&t instanceof TouchEvent||t.touches||t.changedTouches)&&(t=0<t.touches.length?t.touches[0]:t.changedTouches[0]);var i=this._ngEl.nativeElement.getBoundingClientRect(),e=t.clientX-i.left,n=t.clientY-i.top;return"down"===this.cascade&&(n=i.top+i.height-t.clientY),"right"===this.cascade&&(e=i.left+i.width-t.clientX),this.isDragging&&this._zoomOnDrag&&(e*=2,n*=2),{left:e,top:n}},o.prototype._getAbsoluteMousePosition=function(t){return(window.TouchEvent&&t instanceof TouchEvent||t.touches||t.changedTouches)&&(t=0<t.touches.length?t.touches[0]:t.changedTouches[0]),{left:t.clientX,top:t.clientY}},o.prototype._getContainerColumns=function(){var t=this._ngEl.nativeElement.getBoundingClientRect().width;return Math.floor(t/(this.colWidth+this.marginLeft+this.marginRight))},o.prototype._getContainerRows=function(){var t=window.innerHeight-this.marginTop-this.marginBottom;return Math.floor(t/(this.rowHeight+this.marginTop+this.marginBottom))},o.prototype._getItemFromPosition=function(t){for(var i=0,e=this._items;i<e.length;i++){var n=e[i],s=n.getDimensions(),o=n.getPosition();if(t.left>o.left+this.marginLeft&&t.left<o.left+this.marginLeft+s.width&&t.top>o.top+this.marginTop&&t.top<o.top+this.marginTop+s.height)return n}return null},o.prototype._createPlaceholder=function(t){var i=t.getWidgetPosition(),e=t.getSize(),n=this.componentFactoryResolver.resolveComponentFactory(h),s=t.containerRef.createComponent(n),o=(this._placeholderRef=s).instance;o.registerGrid(this),o.setCascadeMode(this.cascade),o.setGridPosition({col:i.col,row:i.row}),o.setSize({x:e.x,y:e.y})},o.prototype._emitOnItemChange=function(){this.onItemChange.emit(this._items.map(function(t){return t.getEventOutput()}))},o.CONST_DEFAULT_CONFIG={margins:[10],draggable:!0,resizable:!0,max_cols:0,max_rows:0,visible_cols:0,visible_rows:0,col_width:250,row_height:250,cascade:"left",min_width:100,min_height:100,fix_to_grid:!1,auto_style:!0,auto_resize:!1,maintain_ratio:!1,prefer_new:!1,zoom_on_drag:!1,allow_overlap:!1,widget_width_factor:0,widget_height_factor:0,debug:!1},o.decorators=[{type:r.Directive,args:[{selector:"[ngWidgetContainer]",inputs:["config: ngWidgetContainer"],host:{"(mousedown)":"mouseDownEventHandler($event)","(mousemove)":"mouseMoveEventHandler($event)","(mouseup)":"mouseUpEventHandler($event)","(touchstart)":"mouseDownEventHandler($event)","(touchmove)":"mouseMoveEventHandler($event)","(touchend)":"mouseUpEventHandler($event)","(window:resize)":"resizeEventHandler($event)","(document:mousemove)":"mouseMoveEventHandler($event)","(document:mouseup)":"mouseUpEventHandler($event)"}}]}],o.ctorParameters=function(){return[{type:r.KeyValueDiffers},{type:r.ElementRef},{type:r.Renderer},{type:r.ComponentFactoryResolver},{type:r.ViewContainerRef}]},o.propDecorators={onDragStart:[{type:r.Output}],onDrag:[{type:r.Output}],onDragStop:[{type:r.Output}],onResizeStart:[{type:r.Output}],onResize:[{type:r.Output}],onResizeStop:[{type:r.Output}],onItemChange:[{type:r.Output}]},o}(),e=function(){function o(t,i,e,n,s){this._differs=t,this._ngEl=i,this._renderer=e,this._ngWidgetContainer=n,this.containerRef=s,this.onItemChange=new r.EventEmitter(!1),this.onDragStart=new r.EventEmitter,this.onDrag=new r.EventEmitter,this.onDragStop=new r.EventEmitter,this.onDragAny=new r.EventEmitter,this.onResizeStart=new r.EventEmitter,this.onResize=new r.EventEmitter,this.onResizeStop=new r.EventEmitter,this.onResizeAny=new r.EventEmitter,this.onChangeStart=new r.EventEmitter,this.onChange=new r.EventEmitter,this.onChangeStop=new r.EventEmitter,this.onChangeAny=new r.EventEmitter,this.ngWidgetChange=new r.EventEmitter,this.isFixed=!1,this.isDraggable=!0,this.isResizable=!0,this.minWidth=0,this.minHeight=0,this._currentPosition={col:1,row:1},this._size={x:1,y:1},this._config=o.CONST_DEFAULT_CONFIG,this._added=!1,this._maxCols=0,this._minCols=0,this._maxRows=0,this._minRows=0,this._dragStartPosition={col:1,row:1}}return Object.defineProperty(o.prototype,"config",{set:function(t){var i=o.CONST_DEFAULT_CONFIG;for(var e in i)t[e]||(t[e]=i[e]);this.setConfig(t),null==this._differ&&null!=t&&(this._differ=this._differs.find(this._config).create(null)),this._added||(this._added=!0,this._ngWidgetContainer.addItem(this)),this._recalculateDimensions(),this._recalculatePosition()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sizex",{get:function(){return this._size.x},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sizey",{get:function(){return this._size.y},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"col",{get:function(){return this._currentPosition.col},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"row",{get:function(){return this._currentPosition.row},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentCol",{get:function(){return this._currentPosition.col},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"currentRow",{get:function(){return this._currentPosition.row},enumerable:!0,configurable:!0}),o.prototype.onResizeStartEvent=function(){var t=this.getEventOutput();this._renderer.setElementStyle(this._ngEl.nativeElement,"z-index",String(++this._ngWidgetContainer.zIndex)),this.onResizeStart.emit(t),this.onResizeAny.emit(t),this.onChangeStart.emit(t),this.onChangeAny.emit(t)},o.prototype.onResizeEvent=function(){var t=this.getEventOutput();this.onResize.emit(t),this.onResizeAny.emit(t),this.onChange.emit(t),this.onChangeAny.emit(t)},o.prototype.onResizeStopEvent=function(){var t=this.getEventOutput();this.onResizeStop.emit(t),this.onResizeAny.emit(t),this.onChangeStop.emit(t),this.onChangeAny.emit(t),this._config.sizex=this._size.x,this._config.sizey=this._size.y,this.ngWidgetChange.emit(this._config)},o.prototype.onDragStartEvent=function(){var t=this.getEventOutput();this._renderer.setElementStyle(this._ngEl.nativeElement,"z-index",String(++this._ngWidgetContainer.zIndex)),this.onDragStart.emit(t),this.onDragAny.emit(t),this.onChangeStart.emit(t),this.onChangeAny.emit(t)},o.prototype.onDragEvent=function(){var t=this.getEventOutput();this.onDrag.emit(t),this.onDragAny.emit(t),this.onChange.emit(t),this.onChangeAny.emit(t)},o.prototype.onDragStopEvent=function(){var t=this.getEventOutput();this.onDragStop.emit(t),this.onDragAny.emit(t),this.onChangeStop.emit(t),this.onChangeAny.emit(t),this._config.col=this._currentPosition.col,this._config.row=this._currentPosition.row,this.ngWidgetChange.emit(this._config)},o.prototype.onCascadeEvent=function(){this._config.sizex=this._size.x,this._config.sizey=this._size.y,this._config.col=this._currentPosition.col,this._config.row=this._currentPosition.row,this.ngWidgetChange.emit(this._config)},o.prototype.ngOnInit=function(){console.log("ngOnInit"),this._renderer.setElementClass(this._ngEl.nativeElement,"widget",!0),this._ngWidgetContainer.autoStyle&&this._renderer.setElementStyle(this._ngEl.nativeElement,"position","absolute"),this._recalculateDimensions(),this._recalculatePosition(),this._added||(this._added=!0,this._ngWidgetContainer.addItem(this))},o.prototype.canDrag=function(t){return!!this.isDraggable&&(!this._dragHandle||this.findHandle(this._dragHandle,t.target))},o.prototype.findHandle=function(t,i){try{for(var e=i;e&&e!==this._ngEl.nativeElement;){if(this.elementMatches(e,t))return!0;e=e.parentElement}}catch(t){}return!1},o.prototype.canResize=function(t){return console.log("isResizable,_resizeHandle,_borderSize",this.isResizable,this._resizeHandle,this._borderSize),this.isResizable?this._resizeHandle?this.findHandle(this._resizeHandle,t.target)?"both":null:this._borderSize<=0?null:this.getResizeDirection(t):null},o.prototype.getResizeDirection=function(t){var i=this._getMousePosition(t);return i.left<this._elemWidth&&i.left>this._elemWidth-this._borderSize&&i.top<this._elemHeight&&i.top>this._elemHeight-this._borderSize?"both":i.left<this._elemWidth&&i.left>this._elemWidth-this._borderSize?"width":i.top<this._elemHeight&&i.top>this._elemHeight-this._borderSize?"height":null},o.prototype.onMouseMove=function(t){if(this._ngWidgetContainer.autoStyle)if(this._ngWidgetContainer.resizeEnable&&!this._resizeHandle&&this.isResizable){var i=this._getMousePosition(t);i.left<this._elemWidth&&i.left>this._elemWidth-this._borderSize&&i.top<this._elemHeight&&i.top>this._elemHeight-this._borderSize?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","nwse-resize"):i.left<this._elemWidth&&i.left>this._elemWidth-this._borderSize?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","ew-resize"):i.top<this._elemHeight&&i.top>this._elemHeight-this._borderSize?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","ns-resize"):this._ngWidgetContainer.dragEnable&&this.canDrag(t)?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","move"):this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","default")}else this._ngWidgetContainer.resizeEnable&&this.canResize(t)?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","nwse-resize"):this._ngWidgetContainer.dragEnable&&this.canDrag(t)?this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","move"):this._renderer.setElementStyle(this._ngEl.nativeElement,"cursor","default")},o.prototype.ngOnDestroy=function(){this._added&&this._ngWidgetContainer.removeItem(this)},o.prototype.getElement=function(){return this._ngEl},o.prototype.getDragHandle=function(){return this._dragHandle},o.prototype.getResizeHandle=function(){return this._resizeHandle},o.prototype.getDimensions=function(){return{width:this._elemWidth,height:this._elemHeight}},o.prototype.getSize=function(){return this._size},o.prototype.getPosition=function(){return{left:this._elemLeft,top:this._elemTop}},o.prototype.getWidgetPosition=function(){return this._currentPosition},o.prototype.getWidgetDragStartPosition=function(){return this._dragStartPosition},o.prototype.setWidgetDragStartPosition=function(t){this._dragStartPosition=t},o.prototype.setConfig=function(t){console.log(t),this._config=t,this._payload=t.payload,this._currentPosition.col=t.col?t.col:o.CONST_DEFAULT_CONFIG.col,this._currentPosition.row=t.row?t.row:o.CONST_DEFAULT_CONFIG.row,this._added||null==(this._ngWidgetContainer.getConfig().widget_width_factor&&t.unitx)?this._size.x=t.sizex?t.sizex:o.CONST_DEFAULT_CONFIG.sizex:(this._size.x=this._ngWidgetContainer.widget_width_factor*t.unitx,console.log(this._size.x,this._ngWidgetContainer.widget_width_factor*t.unitx)),this._added||null==(this._ngWidgetContainer.getConfig().widget_height_factor&&t.unity)?this._size.y=t.sizey?t.sizey:o.CONST_DEFAULT_CONFIG.sizey:this._size.y=this._ngWidgetContainer.widget_height_factor*t.unity,this._dragHandle=t.dragHandle,this._resizeHandle=t.resizeHandle,this._borderSize=t.borderSize,this.isDraggable=!!t.draggable,this.isResizable=!!t.resizable,this.isFixed=!!t.fixed,this._maxCols=!isNaN(t.maxCols)&&isFinite(t.maxCols)?t.maxCols:0,this._minCols=!isNaN(t.minCols)&&isFinite(t.minCols)?t.minCols:0,this._maxRows=!isNaN(t.maxRows)&&isFinite(t.maxRows)?t.maxRows:0,this._minRows=!isNaN(t.minRows)&&isFinite(t.minRows)?t.minRows:0,this.minWidth=!isNaN(t.minWidth)&&isFinite(t.minWidth)?t.minWidth:0,this.minHeight=!isNaN(t.minHeight)&&isFinite(t.minHeight)?t.minHeight:0,0<this._minCols&&0<this._maxCols&&this._minCols>this._maxCols&&(this._minCols=0),0<this._minRows&&0<this._maxRows&&this._minRows>this._maxRows&&(this._minRows=0),this._added&&this._ngWidgetContainer.updateItem(this),this._size=this.fixResize(this._size),this._recalculatePosition(),this._recalculateDimensions()},o.prototype.ngDoCheck=function(){if(null!=this._differ){var t=this._differ.diff(this._config);if(null!=t)return console.log("ngDoCheck -> NgWidget"),this._applyChanges(t),!0}return!1},o.prototype.setSize=function(t,i){void 0===i&&(i=!0),t=this.fixResize(t),this._size=t,i&&this._recalculateDimensions(),this.onItemChange.emit(this.getEventOutput())},o.prototype.setGridPosition=function(t,i){void 0===i&&(i=!0),console.log("widget -> setGridPosition",t),this._currentPosition=t,i&&this._recalculatePosition(),this.onItemChange.emit(this.getEventOutput())},o.prototype.getEventOutput=function(){return{payload:this._payload,col:this._currentPosition.col,row:this._currentPosition.row,sizex:this._size.x,sizey:this._size.y,width:this._elemWidth,height:this._elemHeight,left:this._elemLeft,top:this._elemTop}},o.prototype.setPosition=function(t,i){switch(this._cascadeMode){case"up":case"left":default:this._renderer.setElementStyle(this._ngEl.nativeElement,"left",t+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",i+"px");break;case"right":this._renderer.setElementStyle(this._ngEl.nativeElement,"right",t+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",i+"px");break;case"down":this._renderer.setElementStyle(this._ngEl.nativeElement,"left",t+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",i+"px")}this._elemLeft=t,this._elemTop=i},o.prototype.setCascadeMode=function(t){switch(this._cascadeMode=t){case"up":case"left":default:this._renderer.setElementStyle(this._ngEl.nativeElement,"left",this._elemLeft+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",this._elemTop+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"right",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",null);break;case"right":this._renderer.setElementStyle(this._ngEl.nativeElement,"right",this._elemLeft+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",this._elemTop+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"left",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",null);break;case"down":this._renderer.setElementStyle(this._ngEl.nativeElement,"left",this._elemLeft+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"bottom",this._elemTop+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"right",null),this._renderer.setElementStyle(this._ngEl.nativeElement,"top",null)}},o.prototype.setDimensions=function(t,i){t<this.minWidth&&(t=this.minWidth),i<this.minHeight&&(i=this.minHeight),this._renderer.setElementStyle(this._ngEl.nativeElement,"width",t+"px"),this._renderer.setElementStyle(this._ngEl.nativeElement,"height",i+"px"),this._elemWidth=t,this._elemHeight=i},o.prototype.startMoving=function(){this._renderer.setElementClass(this._ngEl.nativeElement,"moving",!0);var t=window.getComputedStyle(this._ngEl.nativeElement);this._ngWidgetContainer.autoStyle&&this._renderer.setElementStyle(this._ngEl.nativeElement,"z-index",(parseInt(t.getPropertyValue("z-index"),10)+1).toString())},o.prototype.stopMoving=function(){this._renderer.setElementClass(this._ngEl.nativeElement,"moving",!1);var t=window.getComputedStyle(this._ngEl.nativeElement);this._ngWidgetContainer.autoStyle&&this._renderer.setElementStyle(this._ngEl.nativeElement,"z-index",(parseInt(t.getPropertyValue("z-index"),10)-1).toString())},o.prototype.recalculateSelf=function(){this._recalculatePosition(),this._recalculateDimensions()},o.prototype.fixResize=function(t){return 0<this._maxCols&&t.x>this._maxCols&&(t.x=this._maxCols),0<this._maxRows&&t.y>this._maxRows&&(t.y=this._maxRows),0<this._minCols&&t.x<this._minCols&&(t.x=this._minCols),0<this._minRows&&t.y<this._minRows&&(t.y=this._minRows),t.x*this._ngWidgetContainer.colWidth+(this._ngWidgetContainer.marginLeft+this._ngWidgetContainer.marginRight)*(t.x-1)<this.minWidth&&(t.x=Math.round(Math.ceil((this.minWidth+this._ngWidgetContainer.marginRight+this._ngWidgetContainer.marginLeft)/(this._ngWidgetContainer.colWidth+this._ngWidgetContainer.marginRight+this._ngWidgetContainer.marginLeft)))),t.y*this._ngWidgetContainer.rowHeight+(this._ngWidgetContainer.marginTop+this._ngWidgetContainer.marginBottom)*(t.y-1)<this.minHeight&&(t.y=Math.round(Math.ceil((this.minHeight+this._ngWidgetContainer.marginBottom+this._ngWidgetContainer.marginTop)/(this._ngWidgetContainer.rowHeight+this._ngWidgetContainer.marginBottom+this._ngWidgetContainer.marginTop)))),t},o.prototype.elementMatches=function(t,i){if(!t)return!1;if(t.matches)return t.matches(i);if(t.oMatchesSelector)return t.oMatchesSelector(i);if(t.msMatchesSelector)return t.msMatchesSelector(i);if(t.mozMatchesSelector)return t.mozMatchesSelector(i);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(i);if(!t.document||!t.ownerDocument)return!1;for(var e=(t.document||t.ownerDocument).querySelectorAll(i),n=e.length;0<=--n&&e.item(n)!==t;);return-1<n},o.prototype._recalculatePosition=function(){var t=(this._ngWidgetContainer.colWidth+this._ngWidgetContainer.marginLeft+this._ngWidgetContainer.marginRight)*(this._currentPosition.col-1)+this._ngWidgetContainer.marginLeft,i=(this._ngWidgetContainer.rowHeight+this._ngWidgetContainer.marginTop+this._ngWidgetContainer.marginBottom)*(this._currentPosition.row-1)+this._ngWidgetContainer.marginTop;this.setPosition(t,i)},o.prototype._recalculateDimensions=function(){this._size.x<this._ngWidgetContainer.minCols&&(this._size.x=this._ngWidgetContainer.minCols),this._size.y<this._ngWidgetContainer.minRows&&(this._size.y=this._ngWidgetContainer.minRows);var t=this._ngWidgetContainer.colWidth*this._size.x+(this._ngWidgetContainer.marginLeft+this._ngWidgetContainer.marginRight)*(this._size.x-1),i=this._ngWidgetContainer.rowHeight*this._size.y+(this._ngWidgetContainer.marginTop+this._ngWidgetContainer.marginBottom)*(this._size.y-1),e=Math.max(this.minWidth,this._ngWidgetContainer.minWidth,t),n=Math.max(this.minHeight,this._ngWidgetContainer.minHeight,i);this.setDimensions(e,n)},o.prototype._getMousePosition=function(t){if(t.originalEvent&&t.originalEvent.touches){var i=t.originalEvent;t=i.touches.length?i.touches[0]:i.changedTouches.length?i.changedTouches[0]:t}else t.touches&&(t=t.touches.length?t.touches[0]:t.changedTouches.length?t.changedTouches[0]:t);var e=this._ngEl.nativeElement.getBoundingClientRect();return{left:t.clientX-e.left,top:t.clientY-e.top}},o.prototype._applyChanges=function(t){var i=this;t.forEachAddedItem(function(t){i._config[t.key]=t.currentValue}),t.forEachChangedItem(function(t){i._config[t.key]=t.currentValue}),t.forEachRemovedItem(function(t){delete i._config[t.key]}),this.setConfig(this._config)},o.CONST_DEFAULT_CONFIG={col:1,row:1,sizex:1,sizey:1,dragHandle:null,resizeHandle:null,fixed:!1,draggable:!0,resizable:!0,borderSize:25,unitx:0,unity:0},o.decorators=[{type:r.Directive,args:[{selector:"[ngWidget]",inputs:["config: ngWidget"]}]}],o.ctorParameters=function(){return[{type:r.KeyValueDiffers},{type:r.ElementRef},{type:r.Renderer},{type:i},{type:r.ViewContainerRef}]},o.propDecorators={onItemChange:[{type:r.Output}],onDragStart:[{type:r.Output}],onDrag:[{type:r.Output}],onDragStop:[{type:r.Output}],onDragAny:[{type:r.Output}],onResizeStart:[{type:r.Output}],onResize:[{type:r.Output}],onResizeStop:[{type:r.Output}],onResizeAny:[{type:r.Output}],onChangeStart:[{type:r.Output}],onChange:[{type:r.Output}],onChangeStop:[{type:r.Output}],onChangeAny:[{type:r.Output}],ngWidgetChange:[{type:r.Output}]},o}(),n=function(){function t(){}return t.decorators=[{type:r.NgModule,args:[{declarations:[i,e,h],entryComponents:[h],exports:[i,e]}]}],t.ctorParameters=function(){return[]},t}();t.NgWidgetContainer=i,t.NgWidget=e,t.NgWidgetPlaceholder=h,t.NgDraggableWidgetModule=n,Object.defineProperty(t,"__esModule",{value:!0})});